generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model passwordreset {
  id         String   @id @default(uuid())
  user_id    String   @unique
  token      String   @unique
  expiration DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now())
  user       user     @relation(fields: [user_id], references: [id])
}

model exemple {
  id          Int     @id @default(autoincrement())
  name        String
  qtd         Int
  img         String  @db.LongText
  diagramacao String?
}

model box {
  id        Int      @id @default(autoincrement())
  img       String   @db.LongText
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model product {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(255)
  image_key  String?  @db.VarChar(255)
  mime_type  String?  @db.VarChar(100)
  price      Decimal  @default(0.00) @db.Decimal(10, 2)
  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @default(now()) @db.DateTime(0)

  @@index([image_key], map: "idx_product_image_key")
  @@index([name], map: "idx_product_name")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model product_backup {
  id         Int      @default(0)
  name       String   @db.VarChar(255)
  image_key  String?  @db.VarChar(255)
  mime_type  String?  @db.VarChar(100)
  price      Decimal  @default(0.00) @db.Decimal(10, 2)
  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @default(now()) @db.DateTime(0)

  @@ignore
}

model stamps {
  id        Int      @id @default(autoincrement())
  img       String   @db.LongText
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model user {
  id            String         @id
  name          String
  email         String         @unique(map: "User_email_key")
  telefone      String
  asaasId       String?
  password      String
  Logo          String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @default(now())
  Adress        Json?
  passwordreset passwordreset?
}

// ADICIONAR TEMPLATES NO BANCO DE DADOS 

// --- Enums ---
enum TemplateFormat {
  A4_P
  A4_L
  FEED
  STORY
}

enum SlotType {
  IMAGE
  TEXT
  PRICE
  BADGE
}


// --- Models NOVOS ---
model Template {
  id        String   @id @default(uuid())
  baseKey   String   @unique
  name      String
  tags      Json?
  isActive  Boolean  @default(true)
  variants  TemplateVariant[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TemplateVariant {
  id         String    @id @default(uuid())
  templateId String
  template   Template  @relation(fields: [templateId], references: [id])
  format     TemplateFormat
  widthPx    Int
  heightPx   Int
  imageKey   String
  thumbKey   String?
  slotCount  Int
  schemeKey  String?
  version    Int       @default(1)
  status     String    @default("PUBLISHED")
  slots      TemplateSlot[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@index([format])
  @@index([slotCount])
  @@index([schemeKey])
}

model TemplateSlot {
  id        String          @id @default(uuid())
  variantId String
  variant   TemplateVariant @relation(fields: [variantId], references: [id])
  key       String
  type      SlotType
  x         Float
  y         Float
  width     Float
  height    Float
  rotation  Float          @default(0)
  zIndex    Int            @default(0)
  allowed   Json?
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  @@index([variantId])
  @@index([key])
}